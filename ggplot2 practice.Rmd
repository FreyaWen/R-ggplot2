---
title: "ggplot2 studying"
output: html_document
---

##CTRL + ALT + I → 增加代码块

```{r}
library(showtext)

#查看系统字体
windowsFonts()

##定义好导入的字体
Font <- c('STKaiti.TTF','simhei.TTF') ##华文楷体;黑体;
for (i in Font) {
  font_path = i
  font_name = tools::file_path_sans_ext(basename(font_path))
  font_add(font_name, font_path)
}

font_families() ### 查看当前字体
showtext_auto(enable=TRUE) #自动调用showtext，否则无法在ggsave()中使用，因为ggsave会自动打开和关闭图形设备。

#定义字体
Fon <- 'STKaiti'
```

```{r}
library(tidyverse)
library(ggplot2)
library(scales)
library(reshape)

df1 <- read.csv(file.choose(),header = T, sep = ",")
df2 <- read.csv(file.choose(),header = T, sep = ",")
df4 <- read.csv(file.choose(),header = T, sep = ",")

#按照factor的顺序排列x轴
#df1$angle[1:6] → 方便复制条件
reorder_size <- function(angle) {
  factor(df1$angle, levels = c("0°或360°", "60°", "120°", "180°", "240°", "300°"))
}
```

```{r}
##分组柱状图
p1 <- ggplot(data = df1, aes(reorder_size(angle), RT, fill = condition)) +
      geom_bar(stat = "identity", position = position_dodge2(preserve = 'single'), width = 0.7, size = 0.25) +
#修改y轴
      scale_y_continuous(breaks = c(0, 200, 400, 600, 800, 1000, 1200), labels = c("0", "200", "400", "600", "800", "1000", "1200"), limits = c(0, 1200)) +
#增加数据具体数值
      geom_text(aes(label = RT), size = 8/.pt,
            position = position_dodge2(width = 0.7, preserve = 'single'),  vjust = -1.2) +
#增加标题
      xlab("旋转角度") + ylab("平均反应时(ms)") + 
#增加error bar
      geom_errorbar(aes(ymin = RT - 30, ymax = RT + 30),
                    position = position_dodge(0.7),width=0.15) +
#修改图例标题
      labs(fill = "条件") +
#修改图片背景 灰→白
      theme_bw() +
#修改图例背景、颜色、标题大小、大小
      theme(legend.position = c(0.15, 0.8), legend.background = element_rect(fill = 'white', color = 'black'), legend.title = element_text(size = 15), legend.key.size = unit(7, "pt")) +
#坐标轴标签字体
      theme(axis.title = element_text(family = Fon, face='bold', size=13, lineheight = 1), axis.text = element_text(family = Fon, face="bold", size=13))
            
#修改图题位置，并在图题下方增加一行空白
gridExtra::grid.arrange(p1, bottom="图1 不同旋转角度字母的平均反应时
                                                                    ")

#保存图片
ggsave("p1.png", dpi = 300, plot = p1)

```

```{r}
##分组折线图
p2 <- ggplot(data = df1, aes(x = reorder_size(angle), y = RT, group = condition, color = condition, shape = condition))+
      geom_point(size = 2, aes(color = condition))+
      geom_line(size = 0.5) +
#修改y轴
      scale_y_continuous(breaks = c(0, 200, 400, 600, 800, 1000, 1200), labels = c("0", "200", "400", "600", "800", "1000", "1200"), limits = c(0, 1200)) +
#增加标题
      xlab("旋转角度") + ylab("平均反应时(ms)") +
#增加error bar
      geom_errorbar(aes(ymin = RT - 40, ymax = RT + 40),
                    width = 0.05) +
#修改图片背景 灰→白
      theme_bw() +
#图例
      theme(legend.position = 'top')

#修改图题位置，并在图题下方增加一行空白
gridExtra::grid.arrange(p2, bottom="图2 不同旋转角度字母的平均反应时
                                                                    ") 

 
```
```{r}
#使用melt 函数将宽数据gd1转换为长数据gd1_long1
df2_long <- melt(df2,
                 id.vars = c('ID', 'gender'),#需要保留不参与聚合的变量,
                 measure.vars = c('英语','物理'),#用于聚合的变量,
                 variable.name='subject',
                 value.name='score')

##箱图
p3 <- ggplot(df2_long, aes(x = variable, y = value, color = variable)) + 
      geom_boxplot(outlier.colour = "red", outlier.size = 4) +
      geom_jitter(shape=16, position = position_jitter(0.2)) +
      stat_summary(fun.y = mean, geom = "point", shape = 23, size=4) +
#增加标题
      xlab("学科种类") + ylab("考试成绩")+
#修改图片背景 灰→白
      theme_bw() +
#图例
      theme(legend.position = 'none') +
      scale_color_discrete(name="scale change \n Legend",
                          breaks=c("E" ,"P"),
                          labels=c("英语", "物理")  )

#修改图题位置，并在图题下方增加一行空白
gridExtra::grid.arrange(p3, bottom="图3 英语、物理成绩的箱图
                                                            ") 

##条形图
#没走通的小聪明 离散型和连续型有区别
df3 <- data.frame(
          学科种类 = c("英语", "英语", "物理", "物理"),
          考试成绩 = c(83.60, 86.33, 80.33, 82.47),
          性别 = c("男", "女", "男", "女"),
          sd = c(9.91, 6.94, 11.99, 8.45)
      )

p4 <- ggplot(data = df3, aes(x = 学科种类, y = 考试成绩, fill = 性别)) +
      geom_bar(stat = "identity", position = position_dodge2(), width = 0.7, size = 0.25) +
#增加数据具体数值
      geom_text(aes(label = 考试成绩), size = 10/.pt,
            position = position_dodge2(width = 0.7, preserve = 'single'),  vjust = -4.5) +
      scale_y_continuous(breaks = c(0, 20, 40, 60, 80, 100), labels = c("0", "20", "40", "60", "80", "100"), limits = c(0, 100)) +
#增加error bar
      geom_errorbar(aes(ymin = 考试成绩 - sd, ymax = 考试成绩 + sd),
                    position = position_dodge(0.7),width=0.15) +
#修改图片背景 灰→白
      theme_bw() +
#图例
      theme(legend.position = 'top')

#修改图题位置，并在图题下方增加一行空白
gridExtra::grid.arrange(p4, bottom="图4 男生、女生英语、物理成绩的条形图
                                                                         ") 
```
```{r}
p5 <- ggplot(data = df3, aes(x = 学科种类, y = 考试成绩, fill = 性别)) +
      scale_y_continuous(breaks = c(60, 80, 100), labels = c("60", "80", "100"), limits = c(60, 100)) +
#增加error bar
      geom_errorbar(aes(ymin = 考试成绩 - sd, ymax = 考试成绩 + sd),
                    position = position_dodge(0.7),width=0.3) +
      stat_summary(fun.y = mean, geom = "point", shape = 23, size=4, position = position_dodge(0.7)) +
#修改图片背景 灰→白
      theme_bw() +
#图例
      theme(legend.position = 'top')

#修改图题位置，并在图题下方增加一行空白
gridExtra::grid.arrange(p5, bottom="图5 男生、女生英语、物理成绩的误差条形图
                                                                            ") 
```
```{r}
##散点图
p6 <- ggplot(data = df2, aes(x = 英语, y = 物理))+
      geom_point(colour = "dark red")+
      geom_smooth(method = lm) +
      scale_y_continuous(breaks = c(60, 80, 100), labels = c("60", "80", "100"), limits = c(60, 100)) +
      scale_x_continuous(breaks = c(60, 80, 100), labels = c("60", "80", "100"), limits = c(60, 100)) +
#修改图片背景 灰→白
      theme_bw() 

#修改图题位置，并在图题下方增加一行空白
gridExtra::grid.arrange(p6, bottom="图6 英语、物理成绩的散点图
                                                              ")
```

```{r}
##饼图
#df4$group <- factor(df4$group,
#                    levels = c('1','2','3','4','5'),
#                    labels = c("<5%","5%-20%","20%-80%","80%-95%",">95%"))

p7 <- ggplot(data = df4, mapping = aes(x = ' ', y = group, fill = group)) +  
      geom_bar(stat = 'identity', position = 'stack', width = 1) +
      coord_polar(theta = 'y') +
      coord_polar(theta = 'y') + labs(x = '', y = '', title = '') + theme(axis.text = element_blank()) + theme(axis.ticks = element_blank()) +
#修改图片背景 灰→白
      theme_bw() 


#修改图题位置，并在图题下方增加一行空白
gridExtra::grid.arrange(p7, bottom="图7 不同组被试数的饼图
                                                          ")                                                   
```

